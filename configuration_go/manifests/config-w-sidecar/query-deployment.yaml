# Generated by mimic. DO NOT EDIT.
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: query-layer
    app.kubernetes.io/instance: observatorium-xyz
    app.kubernetes.io/name: thanos-query
    app.kubernetes.io/part-of: observatorium
  name: observatorium-xyz-thanos-query
  namespace: observatorium
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: query-layer
      app.kubernetes.io/instance: observatorium-xyz
      app.kubernetes.io/name: thanos-query
      app.kubernetes.io/part-of: observatorium
      app.kubernetes.io/version: v0.31
  strategy:
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1
  template:
    metadata:
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: query-layer
        app.kubernetes.io/instance: observatorium-xyz
        app.kubernetes.io/name: thanos-query
        app.kubernetes.io/part-of: observatorium
      namespace: observatorium
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - thanos-query
              topologyKey: kubernetes.io/hostname
            weight: 100
      containers:
      - args:
        - query
        - --log.level=debug
        - --log.format=logfmt
        - --http-address=0.0.0.0:9090
        - --grpc-address=0.0.0.0:10901
        - --grpc.proxy-strategy=eager
        - --web.prefix-header=X-Forwarded-Prefix
        - --query.auto-downsampling
        - --query.lookback-delta=15m
        - --query.max-concurrent=20
        - --query.promql-engine=prometheus
        - --query.timeout=15m
        - |
          --tracing.config=type: JAEGER
          config:
            service_name: thanos-query
            sampler_type: ratelimiting
            sampler_param: 2
        - --query.replica-label=replica
        - --query.replica-label=rule_replica
        - --query.replica-label=prometheus_replica
        - --query.telemetry.request-duration-seconds-quantiles=0.100000
        - --query.telemetry.request-duration-seconds-quantiles=0.250000
        - --query.telemetry.request-duration-seconds-quantiles=0.750000
        - --query.telemetry.request-duration-seconds-quantiles=1.250000
        - --query.telemetry.request-duration-seconds-quantiles=1.750000
        - --query.telemetry.request-duration-seconds-quantiles=2.000000
        - --query.telemetry.request-duration-seconds-quantiles=3.000000
        - --query.telemetry.request-duration-seconds-quantiles=5.000000
        - --query.telemetry.request-duration-seconds-quantiles=10.000000
        - --query.telemetry.request-duration-seconds-quantiles=15.000000
        - --query.telemetry.request-duration-seconds-quantiles=30.000000
        - --query.telemetry.request-duration-seconds-quantiles=60.000000
        - --query.telemetry.request-duration-seconds-quantiles=120.000000
        - --endpoint=dnssrv+_grpc._tcp.observatorium-thanos-store-shard-0.observatorium.svc.cluster.local
        - --endpoint=dnssrv+_grpc._tcp.observatorium-thanos-store-shard-1.observatorium.svc.cluster.local
        - --endpoint=dnssrv+_grpc._tcp.observatorium-thanos-store-shard-2.observatorium.svc.cluster.local
        - --endpoint=dnssrv+_grpc._tcp.observatorium-thanos-receive.observatorium.svc.cluster.local
        - --store.sd-files=etc/thanos/sd/rule-sd.yaml
        image: quay.io/thanos-io/thanos:v0.31
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 4
          httpGet:
            path: /-/healthy
            port: 9090
            scheme: HTTP
          periodSeconds: 30
        name: thanos-query
        ports:
        - containerPort: 10901
          name: grpc
        - containerPort: 9090
          name: http
        - containerPort: 9091
          name: https
        readinessProbe:
          failureThreshold: 20
          httpGet:
            path: /-/ready
            port: 9090
            scheme: HTTP
          periodSeconds: 5
        resources:
          limits:
            cpu: "3"
            memory: 3000Mi
          requests:
            cpu: "2"
            memory: 2000Mi
        terminationMessagePolicy: FallbackToLogsOnError
        volumeMounts:
        - mountPath: etc/thanos/sd
          name: file-sd
      - args:
        - --start-dummy-sidecar
        image: docker.io/dummy:latest
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 10
          httpGet:
            path: /live
            port: 7081
            scheme: HTTP
          periodSeconds: 30
        name: dummy-sidecar
        ports:
        - containerPort: 7081
          name: dummy-metrics
        - containerPort: 7080
          name: dummy
        resources: {}
        terminationMessagePolicy: FallbackToLogsOnError
        volumeMounts:
        - mountPath: /etc/dummy-sidecar/config.yaml
          name: config
          readOnly: true
          subPath: config.yaml
      nodeSelector:
        kubernetes.io/os: linux
      securityContext:
        fsGroup: 65534
        runAsUser: 65534
      serviceAccountName: observatorium-xyz-thanos-query
      volumes:
      - configMap:
          name: observatorium-xyz-thanos-query
        name: file-sd
      - configMap:
          name: dummy-sidecar-config
        name: config
status: {}
